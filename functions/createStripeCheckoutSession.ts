import { base44 } from '@base44/sdk';\n\nexport default async function createStripeCheckoutSession(req, res) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const { priceId, userId, storeId, successUrl, cancelUrl } = req.body;\n\n    // Validar dados\n    if (!priceId || !userId || !storeId) {\n      return res.status(400).json({ error: 'Missing required fields' });\n    }\n\n    // Configurar Stripe (substitua pela sua chave secreta)\n    const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);\n\n    // Buscar dados da loja\n    const store = await base44.entities.Store.get(storeId);\n    if (!store) {\n      return res.status(404).json({ error: 'Store not found' });\n    }\n\n    // Criar sess√£o do Stripe Checkout\n    const session = await stripe.checkout.sessions.create({\n      payment_method_types: ['card'],\n      line_items: [\n        {\n          price: priceId,\n          quantity: 1,\n        },\n      ],\n      mode: 'subscription',\n      success_url: successUrl,\n      cancel_url: cancelUrl,\n      customer_email: store.email_empresa,\n      metadata: {\n        userId: userId,\n        storeId: storeId,\n        storeName: store.name\n      },\n      subscription_data: {\n        metadata: {\n          userId: userId,\n          storeId: storeId,\n          storeName: store.name\n        }\n      }\n    });\n\n    res.status(200).json({\n      url: session.url,\n      sessionId: session.id\n    });\n\n  } catch (error) {\n    console.error('Stripe checkout error:', error);\n    res.status(500).json({ error: error.message });\n  }\n}